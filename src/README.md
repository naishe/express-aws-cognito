# express-aws-cognito

Express AWS Cognito is a middleware for Express.js (and other Node.js webapplication frameworks that support Express.js middlewares like [koa](https://github.com/vkurchatkin/koa-connect)). You can also use it in AWS Lambda.

This middleware authenticates Access Tokens and ID Tokens generated by Amazon Cognito service. It is highly inspired by [cognito-express](https://github.com/ghdna/cognito-express) and aspires to be in place replacement for it.

This library is a nice little wrapper around [jsonwebtoken](https://github.com/auth0/node-jsonwebtoken) library. As a middleware it does the following:

1. On initialization, it downloads and stores the public JSON Web Key (JWK) for specific to your user pool. (No further networks trips)
2. Verifies JWT claims as specified in [AWS Cognito official document](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html#amazon-cognito-user-pools-using-tokens-step-3)

The library verifies the following claims:

1. Verify that the token is not expired. You can enforce your custom expiration by setting `maxAge` at client level.
2. The audience (`aud`) claim should match the app client ID that was created in the Amazon Cognito user pool. (TODO!)
3. The issuer (`iss`) claim should match your user pool.
4. Check the `token_use` claim.
   - If you are only accepting the access token in your web API operations, its value must be `access`.
   - If you are only using the ID token, its value must be `id`.
   - If you are using both ID and access tokens, the `token_use` claim must be either `id` or `access`.
